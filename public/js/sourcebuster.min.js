/** sourcebuster-js v1.0.0-beta **/
!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;"undefined"!=typeof window?t=window:"undefined"!=typeof global?t=global:"undefined"!=typeof self&&(t=self),t.sbjs=e()}}(function(){return function e(t,r,n){function s(i,o){if(!r[i]){if(!t[i]){var c="function"==typeof require&&require;if(!o&&c)return c(i,!0);if(a)return a(i,!0);var u=new Error("Cannot find module '"+i+"'");throw u.code="MODULE_NOT_FOUND",u}var p=r[i]={exports:{}};t[i][0].call(p.exports,function(e){var r=t[i][1][e];return s(r?r:e)},p,p.exports,e,t,r,n)}return r[i].exports}for(var a="function"==typeof require&&require,i=0;i<n.length;i++)s(n[i]);return s}({1:[function(e,t){"use strict";var r=e("./init"),n={init:function(e){this.get=r(e),e.callback&&"function"==typeof e.callback&&e.callback(this.get)}};t.exports=n},{"./init":6}],2:[function(e,t){"use strict";var r=e("./terms"),n=e("./helpers/utils"),s={containers:{current:"sbjs_current",current_extra:"sbjs_current_add",first:"sbjs_first",first_extra:"sbjs_first_add",session:"sbjs_session",udata:"sbjs_udata",promocode:"sbjs_promo"},service:{migrations:"sbjs_migrations"},delimiter:"|||",aliases:{main:{type:"typ",source:"src",medium:"mdm",campaign:"cmp",content:"cnt",term:"trm"},extra:{fire_date:"fd",entrance_point:"ep",referer:"rf"},session:{pages_seen:"pgs",current_page:"cpg"},udata:{visits:"vst",ip:"uip",agent:"uag"},promo:"code"},pack:{main:function(e){return s.aliases.main.type+"="+e.type+s.delimiter+s.aliases.main.source+"="+e.source+s.delimiter+s.aliases.main.medium+"="+e.medium+s.delimiter+s.aliases.main.campaign+"="+e.campaign+s.delimiter+s.aliases.main.content+"="+e.content+s.delimiter+s.aliases.main.term+"="+e.term},extra:function(e){return s.aliases.extra.fire_date+"="+n.setDate(new Date,e)+s.delimiter+s.aliases.extra.entrance_point+"="+document.location.href+s.delimiter+s.aliases.extra.referer+"="+(document.referrer||r.none)},user:function(e,t){return s.aliases.udata.visits+"="+e+s.delimiter+s.aliases.udata.ip+"="+t+s.delimiter+s.aliases.udata.agent+"="+navigator.userAgent},session:function(e){return s.aliases.session.pages_seen+"="+e+s.delimiter+s.aliases.session.current_page+"="+document.location.href},promo:function(e){return s.aliases.promo+"="+n.setLeadingZeroToInt(n.randomInt(e.min,e.max),e.max.toString().length)}}};t.exports=s},{"./helpers/utils":5,"./terms":9}],3:[function(e,t){"use strict";var r=e("../data").delimiter;t.exports={encodeData:function(e){return encodeURIComponent(e).replace(/\!/g,"%21").replace(/\~/g,"%7E").replace(/\*/g,"%2A").replace(/\'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29")},decodeData:function(e){try{return decodeURIComponent(e).replace(/\%21/g,"!").replace(/\%7E/g,"~").replace(/\%2A/g,"*").replace(/\%27/g,"'").replace(/\%28/g,"(").replace(/\%29/g,")")}catch(t){try{return unescape(e)}catch(r){return""}}},set:function(e,t,r,n,s){var a,i;if(r){var o=new Date;o.setTime(o.getTime()+60*r*1e3),a="; expires="+o.toGMTString()}else a="";i=n&&!s?";domain=."+n:"",document.cookie=this.encodeData(e)+"="+this.encodeData(t)+a+i+"; path=/"},get:function(e){for(var t=this.encodeData(e)+"=",r=document.cookie.split(";"),n=0;n<r.length;n++){for(var s=r[n];" "===s.charAt(0);)s=s.substring(1,s.length);if(0===s.indexOf(t))return this.decodeData(s.substring(t.length,s.length))}return null},destroy:function(e,t,r){this.set(e,"",-1,t,r)},parse:function(e){var t=[],n={};if("string"==typeof e)t.push(e);else for(var s in e)e.hasOwnProperty(s)&&t.push(e[s]);for(var a=0;a<t.length;a++){var i;n[this.unsbjs(t[a])]={},i=this.get(t[a])?this.get(t[a]).split(r):[];for(var o=0;o<i.length;o++){var c=i[o].split("="),u=c.splice(0,1);u.push(c.join("=")),n[this.unsbjs(t[a])][u[0]]=this.decodeData(u[1])}}return n},unsbjs:function(e){return e.replace("sbjs_","")}}},{"../data":2}],4:[function(e,t){"use strict";t.exports={parse:function(e){for(var t=this.parseOptions,r=t.parser[t.strictMode?"strict":"loose"].exec(e),n={},s=14;s--;)n[t.key[s]]=r[s]||"";return n[t.q.name]={},n[t.key[12]].replace(t.q.parser,function(e,r,s){r&&(n[t.q.name][r]=s)}),n},parseOptions:{strictMode:!1,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}},getParam:function(e){for(var t={},r=e?e:window.location.search.substring(1),n=r.split("&"),s=0;s<n.length;s++){var a=n[s].split("=");if("undefined"==typeof t[a[0]])t[a[0]]=a[1];else if("string"==typeof t[a[0]]){var i=[t[a[0]],a[1]];t[a[0]]=i}else t[a[0]].push(a[1])}return t},getHost:function(e){return this.parse(e).host.replace("www.","")}}},{}],5:[function(e,t){"use strict";t.exports={escapeRegexp:function(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},setDate:function(e,t){var r=e.getTimezoneOffset()/60,n=e.getHours(),s=t||-r;e.setHours(n+r+s);var a=e.getFullYear(),i=this.setLeadingZeroToInt(e.getMonth(),2),o=this.setLeadingZeroToInt(e.getDate(),2),c=this.setLeadingZeroToInt(e.getHours(),2),u=this.setLeadingZeroToInt(e.getMinutes(),2),p=this.setLeadingZeroToInt(e.getSeconds(),2);return a+"-"+i+"-"+o+" "+c+":"+u+":"+p},setLeadingZeroToInt:function(e,t){for(var r=e+"";r.length<t;)r="0"+r;return r},randomInt:function(e,t){return Math.floor(Math.random()*(t-e+1))+e}}},{}],6:[function(e,t){"use strict";var r=e("./data"),n=e("./terms"),s=e("./helpers/cookies"),a=e("./helpers/uri"),i=e("./helpers/utils"),o=e("./params"),c=e("./migrations");t.exports=function(e){function t(){var e;if("undefined"!=typeof y.utm_source||"undefined"!=typeof y.utm_medium||"undefined"!=typeof y.utm_campaign||"undefined"!=typeof y.utm_content||"undefined"!=typeof y.utm_term||"undefined"!=typeof y.gclid||"undefined"!=typeof y[h.campaign_param])g(),e=u(n.traffic.utm);else if(f(n.traffic.organic))g(),e=u(n.traffic.organic);else if(!s.get(r.containers.session)&&f(n.traffic.referral))g(),e=u(n.traffic.referral);else{if(s.get(r.containers.first)||s.get(r.containers.current))return s.get(r.containers.current);g(),e=u(n.traffic.typein)}return e}function u(e){switch(e){case n.traffic.utm:x=n.traffic.utm,k="undefined"!=typeof y.utm_source?y.utm_source:"undefined"!=typeof y.gclid?"google":n.none,w="undefined"!=typeof y.utm_medium?y.utm_medium:"undefined"!=typeof y.gclid?"cpc":n.none,q="undefined"!=typeof y.utm_campaign?y.utm_campaign:"undefined"!=typeof y[h.campaign_param]?y[h.campaign_param]:"undefined"!=typeof y.gclid?"google_cpc":n.none,I=y.utm_content||n.none,j=p()||n.none;break;case n.traffic.organic:x=n.traffic.organic,k=k||a.getHost(document.referrer),w=n.referer.organic,q=n.none,I=n.none,j=n.none;break;case n.traffic.referral:x=n.traffic.referral,k=k||a.getHost(document.referrer),w=w||n.referer.referral,q=n.none,I=a.parse(document.referrer).path,j=n.none;break;case n.traffic.typein:x=n.traffic.typein,k=h.typein_attributes.source,w=h.typein_attributes.medium,q=n.none,I=n.none,j=n.none;break;default:x=n.oops,k=n.oops,w=n.oops,q=n.oops,I=n.oops,j=n.oops}var t={type:x,source:k,medium:w,campaign:q,content:I,term:j};return r.pack.main(t)}function p(){var e=document.referrer;if(y.utm_term)return y.utm_term;if(!(e&&a.parse(e).host&&a.parse(e).host.match(/^(?:.*\.)?yandex\..{2,9}$/i)))return!1;try{return a.getParam(a.parse(document.referrer).query).text}catch(t){return!1}}function f(e){var t=document.referrer;switch(e){case n.traffic.organic:return!!t&&m(t)&&l(t);case n.traffic.referral:return!!t&&m(t)&&d(t);default:return!1}}function m(e){if(h.domain){if(_)return a.getHost(e)!==a.getHost(v);var t=new RegExp("^(?:.*\\.)?"+i.escapeRegexp(v)+"$","i");return!a.getHost(e).match(t)}return a.getHost(e)!==a.getHost(document.location.href)}function l(e){var t="yandex",r="text",n="google",s=new RegExp("^(?:.*\\.)?"+i.escapeRegexp(t)+"\\..{2,9}$"),o=new RegExp(".*"+i.escapeRegexp(r)+"=.*"),c=new RegExp("^(?:www\\.)?"+i.escapeRegexp(n)+"\\..{2,9}$");if(a.parse(e).query&&a.parse(e).host.match(s)&&a.parse(e).query.match(o))return k=t,!0;if(a.parse(e).host.match(c))return k=n,!0;if(!a.parse(e).query)return!1;for(var u=0;u<h.organics.length;u++){if(a.parse(e).host.match(new RegExp("^(?:.*\\.)?"+i.escapeRegexp(h.organics[u].host)+"$","i"))&&a.parse(e).query.match(new RegExp(".*"+i.escapeRegexp(h.organics[u].param)+"=.*","i")))return k=h.organics[u].display||h.organics[u].host,!0;if(u+1===h.organics.length)return!1}}function d(e){if(!(h.referrals.length>0))return k=a.getHost(e),!0;for(var t=0;t<h.referrals.length;t++){if(a.parse(e).host.match(new RegExp("^(?:.*\\.)?"+i.escapeRegexp(h.referrals[t].host)+"$","i")))return k=h.referrals[t].display||h.referrals[t].host,w=h.referrals[t].medium||n.referer.referral,!0;if(t+1===h.referrals.length)return k=a.getHost(e),!0}}function g(){s.set(r.containers.current_extra,r.pack.extra(h.timezone_offset),b,v,_),s.get(r.containers.first_extra)||s.set(r.containers.first_extra,r.pack.extra(h.timezone_offset),b,v,_)}var h=o.fetch(e),y=a.getParam(),v=h.domain.host,_=h.domain.isolate,b=h.lifetime;c.go(b,v,_);var x,k,w,q,I,j;return function(){s.set(r.containers.current,t(),b,v,_),s.get(r.containers.first)||s.set(r.containers.first,s.get(r.containers.current),b,v,_);var e,n;s.get(r.containers.udata)?(e=parseInt(s.parse(r.containers.udata)[s.unsbjs(r.containers.udata)][r.aliases.udata.visits])||1,e=s.get(r.containers.session)?e:e+1,n=r.pack.user(e,h.user_ip)):(e=1,n=r.pack.user(e,h.user_ip)),s.set(r.containers.udata,n,b,v,_);var a;s.get(r.containers.session)?(a=parseInt(s.parse(r.containers.session)[s.unsbjs(r.containers.session)][r.aliases.session.pages_seen])||1,a+=1):a=1,s.set(r.containers.session,r.pack.session(a),h.session_length,v,_),h.promocode&&!s.get(r.containers.promocode)&&s.set(r.containers.promocode,r.pack.promo(h.promocode),b,v,_)}(),s.parse(r.containers)}},{"./data":2,"./helpers/cookies":3,"./helpers/uri":4,"./helpers/utils":5,"./migrations":7,"./params":8,"./terms":9}],7:[function(e,t){"use strict";var r=e("./data"),n=e("./helpers/cookies");t.exports={go:function(e,t,s){for(var a=this.migrations,i={l:e,d:t,i:s},o=[],c=0;c<a.length;c++)o.push(a[c].id);if(n.get(r.containers.first)||n.get(r.service.migrations)){if(!n.get(r.service.migrations))for(c=0;c<a.length;c++)a[c].do(a[c].id,i)}else{var u="";for(c=0;c<o.length;c++)u+=o[c]+"=1",c<o.length-1&&(u+=r.delimiter);n.set(r.service.migrations,u,i.l,i.d,i.i)}},migrations:[{id:"1418474375998",version:"1.0.0-beta","do":function(e,t){var s=e+"=1",a=e+"=0",i=function(e,t,n){return t||n?e:r.delimiter};try{var o=[];for(var c in r.containers)r.containers.hasOwnProperty(c)&&o.push(r.containers[c]);for(var u=0;u<o.length;u++)if(n.get(o[u])){var p=n.get(o[u]).replace(/(\|)?\|(\|)?/g,i);n.destroy(o[u],t.d,t.i),n.destroy(o[u],t.d,!t.i),n.set(o[u],p,t.l,t.d,t.i)}n.get(r.containers.session)&&n.set(r.containers.session,r.pack.session(0),t.l,t.d,t.i),n.set(r.service.migrations,s,t.l,t.d,t.i)}catch(f){n.set(r.service.migrations,a,t.l,t.d,t.i)}}}]}},{"./data":2,"./helpers/cookies":3}],8:[function(e,t){"use strict";var r=e("./terms"),n=e("./helpers/uri");t.exports={fetch:function(e){var t={};if(t.lifetime=this.validate.checkFloat(e.lifetime)||6,t.lifetime=parseInt(30*t.lifetime*24*60),t.session_length=this.validate.checkInt(e.session_length)||30,t.timezone_offset=this.validate.checkInt(e.timezone_offset),t.campaign_param=e.campaign_param||!1,t.user_ip=e.user_ip||r.none,e.promocode?(t.promocode={},t.promocode.min=parseInt(e.promocode.min)||1e5,t.promocode.max=parseInt(e.promocode.max)||999999):t.promocode=!1,e.typein_attributes&&e.typein_attributes.source&&e.typein_attributes.medium?(t.typein_attributes={},t.typein_attributes.source=e.typein_attributes.source,t.typein_attributes.medium=e.typein_attributes.medium):t.typein_attributes={source:"(direct)",medium:"(none)"},t.domain=e.domain&&this.validate.isString(e.domain)?{host:e.domain,isolate:!1}:e.domain&&e.domain.host?e.domain:{host:n.getHost(document.location.hostname),isolate:!1},t.referrals=[],e.referrals&&e.referrals.length>0)for(var s=0;s<e.referrals.length;s++)e.referrals[s].host&&t.referrals.push(e.referrals[s]);if(t.organics=[],e.organics&&e.organics.length>0)for(var a=0;a<e.organics.length;a++)e.organics[a].host&&e.organics[a].param&&t.organics.push(e.organics[a]);return t.organics.push({host:"bing.com",param:"q",display:"bing"}),t.organics.push({host:"yahoo.com",param:"p",display:"yahoo"}),t.organics.push({host:"about.com",param:"q",display:"about"}),t.organics.push({host:"aol.com",param:"q",display:"aol"}),t.organics.push({host:"ask.com",param:"q",display:"ask"}),t.organics.push({host:"globososo.com",param:"q",display:"globo"}),t.organics.push({host:"go.mail.ru",param:"q",display:"go.mail.ru"}),t.organics.push({host:"rambler.ru",param:"query",display:"rambler"}),t.organics.push({host:"tut.by",param:"query",display:"tut.by"}),t},validate:{checkFloat:function(e){return e&&this.validate.isNumeric(parseFloat(e))?parseFloat(e):!1},checkInt:function(e){return e&&this.validate.isNumeric(parseInt(e))?parseInt(e):!1},isNumeric:function(e){return!isNaN(e)},isString:function(e){return"[object String]"===Object.prototype.toString.call(e)}}}},{"./helpers/uri":4,"./terms":9}],9:[function(e,t){"use strict";t.exports={traffic:{utm:"utm",organic:"organic",referral:"referral",typein:"typein"},referer:{referral:"referral",organic:"organic",social:"social"},none:"(none)",oops:"(Houston, we have a problem)"}},{}]},{},[1])(1)});